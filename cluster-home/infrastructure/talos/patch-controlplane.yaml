cluster:
  apiServer:
    admissionControl:
    - name: PodSecurity
      configuration:
        apiVersion: pod-security.admission.config.k8s.io/v1beta1
        defaults:
          enforce: privileged
          enforce-version: latest
          audit: privileged
          audit-version: latest
          warn: privileged
          warn-version: latest
        exemptions:
          namespaces:
          - storage
          runtimeClasses: []
          usernames: []
        kind: PodSecurityConfiguration
  inlineManifests:
  - name: cilium
    contents: |
      ---
      # Source: cilium/templates/cilium-secrets-namespace.yaml
      apiVersion: v1
      kind: Namespace
      metadata:
        name: "cilium-secrets"
        labels:
          app.kubernetes.io/part-of: cilium
        annotations:
      ---
      # Source: cilium/templates/cilium-agent/serviceaccount.yaml
      apiVersion: v1
      kind: ServiceAccount
      metadata:
        name: "cilium"
        namespace: kube-system
      ---
      # Source: cilium/templates/cilium-envoy/serviceaccount.yaml
      apiVersion: v1
      kind: ServiceAccount
      metadata:
        name: "cilium-envoy"
        namespace: kube-system
      ---
      # Source: cilium/templates/cilium-operator/serviceaccount.yaml
      apiVersion: v1
      kind: ServiceAccount
      metadata:
        name: "cilium-operator"
        namespace: kube-system
      ---
      # Source: cilium/templates/cilium-ca-secret.yaml
      apiVersion: v1
      kind: Secret
      metadata:
        name: cilium-ca
        namespace: kube-system
        labels:
          cilium.io/helm-template-non-idempotent: "true"
      data:
        ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURGRENDQWZ5Z0F3SUJBZ0lSQVA2VFF6WnlsNTM5M0FyWkNrUVBLOUl3RFFZSktvWklodmNOQVFFTEJRQXcKRkRFU01CQUdBMVVFQXhNSlEybHNhWFZ0SUVOQk1CNFhEVEkyTURJeE5ERXlNVEF5TmxvWERUSTVNREl4TXpFeQpNVEF5Tmxvd0ZERVNNQkFHQTFVRUF4TUpRMmxzYVhWdElFTkJNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DCkFROEFNSUlCQ2dLQ0FRRUFxR1lwVFFoSnZMNk5TN1hBNFdmdFlRaGVqWFAvM2JMU2M0Qm14MzhRQXRaS2VoV2QKVk5XNTh0dzU4R3RVM1dQYUkxM01VZXR2NWhMa2ttbVovMkZ1OCtydGVTMTIvV1pZTk55WU42aEZHSGpWOFB5cwo4K3QrcnZSLzkzWS8rcUJqWGg0bEpVaHdzdFduNXNxaUpiRytVbzkxMWozUzZxU01oWXBTckpKdWxndk5USGtlCkxzS0xEV01COEZQMWdLTnN1cnB2K1VvQzZWTFluVFlxa0pMbHlEZjQzSTM3T3lzU1krdjRKLzduNmlGS1pTc0sKR2JOS2pCVll0ZDBGMkZwMXVUTEozQWpBSzBpc0VLb2kzelg1TGlJZ3hQSzJmQldDN25BVGZQMFpQNDZkMEtpagpFeTdwMEwvcURYWnR4KzViaVRPaGQyUDdwSHdFaFVWTHM2cURDd0lEQVFBQm8yRXdYekFPQmdOVkhROEJBZjhFCkJBTUNBcVF3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdFR0NDc0dBUVVGQndNQ01BOEdBMVVkRXdFQi93UUYKTUFNQkFmOHdIUVlEVlIwT0JCWUVGSTd2cmtrcXNJWkI4K0tpZ09WLzdTOUlkNkZiTUEwR0NTcUdTSWIzRFFFQgpDd1VBQTRJQkFRQ1hVSCtCL3J1NEtBNVlnWVl4ZHM1dUlaek1qYjlUOFhpTlA1bFRtcXplSnI3S3hTZStwbTU5CjNTNnlsQTQvMVdVcGlrdFBUMUlOUHJ1WFZXVUJGL1NyRE4wWDIyT0psWlg2YjdVWUduaUVnZDJ6MDVLOStBTzUKYTZ0YSt3bnI0SHg0Z0dmWnhHcytjazhwMTBjeC9HeWpDY1c1THZWMDQvOWo4QVdFamNtcDBFV1oxRUszWnlSdAp3eGNsbHJVcC8ySHVxa1lSdS85Q0ljV3ZRVEV0RDIwN1lRN25QVjFzWnVCUVhtVnlzVEVPN2thbmRCYWlxdGVaClBaYURGckJzdnFHME5yblJJL3oyRUNJZnFxVUNrNUpBNDhlcEs4SGJzOWZ6TnU5bVNYSTVmcDh3UnVGR0xidFgKR0ZoZURHbEVUR0o2RUp4aHBVQS81dUpnZzJXZlE4YlUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
        ca.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBcUdZcFRRaEp2TDZOUzdYQTRXZnRZUWhlalhQLzNiTFNjNEJteDM4UUF0WktlaFdkClZOVzU4dHc1OEd0VTNXUGFJMTNNVWV0djVoTGtrbW1aLzJGdTgrcnRlUzEyL1daWU5OeVlONmhGR0hqVjhQeXMKOCt0K3J2Ui85M1kvK3FCalhoNGxKVWh3c3RXbjVzcWlKYkcrVW85MTFqM1M2cVNNaFlwU3JKSnVsZ3ZOVEhrZQpMc0tMRFdNQjhGUDFnS05zdXJwditVb0M2VkxZblRZcWtKTGx5RGY0M0kzN095c1NZK3Y0Si83bjZpRktaU3NLCkdiTktqQlZZdGQwRjJGcDF1VExKM0FqQUswaXNFS29pM3pYNUxpSWd4UEsyZkJXQzduQVRmUDBaUDQ2ZDBLaWoKRXk3cDBML3FEWFp0eCs1YmlUT2hkMlA3cEh3RWhVVkxzNnFEQ3dJREFRQUJBb0lCQUV1NFdEVGJsN0JuYkVoUgpTdy92dDhUTVN4dkd2NVBUN3g1aGE1V2p0RExhWVhYQTExUklvQXFzYk44R25BdktkTkUzUVlMS1h5L3dhZGZOCjVTRjRrYmZhK0hubThCeWtFdUIrR25IWVYyMVlGRGIrbnRRMUhXc1U1SitFaStNcGtGVEhNRU94N1g3MFpFRjUKOXV3RkhzT24zei84MzZTRFplNDhFczJuTUZPRjh5d0xWYlhhTHpWYWZPaDU5RkpWODJKR2dtZmNKK2h4cUZrMwo1QzgzWEJwT3NxMU9VTjRYQ1VFbkVIZDFuRFgyTUkwQTZiZlNIaitYbUswdk10WnozbXRKSUMyV0dKcytnRTZJCnUvYUZqS0RkWmlXQW93Q1doT3haQWFnbDdaUlVtLzI1SUdpdFE0bjkrT1FZWW9OZXJVM25mL1ZiOWR5NGkwVUIKblJxM2V3a0NnWUVBMXpIMS9iQzQyYmluM3VueUUyWjB4WklsbGIvQ0dUenB5QUNnZ3NDNjNLM04xOHFKajYrYgpvUDlObXIxaWNFVDZLeGw2NG56SVhRMVFpQWxQakR5dTF4UlVJZG9qSm1tdmw3SVR6V1BhU084alVRTTdsR3p6CnVjUFdVdWZ4SnVZMTVGWGlEN01TUndXWGoyVUltMlQzUmw4U2g1djVtY1dlTnZoR2lLaEg4UE1DZ1lFQXlGU2QKNVBxUHpCRE53bzdKU2duTHRTeGxaWlVQSlE4QVdLa09zUDB3MzNTQXhLMWJ0bHhLSHI3TmJWQmJrVjRQeDQ2aQorNkxZQTlaQ1ptRDd3QzEyVlZGcE9QS25HVHYyRUNKWFFwMkVLM0hvSGJRdXVkWVlmOEdLd3l5TURqSzBQd1YyClR3c1ZmMW9NdFQ5MmhvY0J3eHFxN3htR2xFU2QxcjdxMjhQM2E0a0NnWUFEZkxYRnhLVmFNZG5Xak9mMVZJV3oKNWVoaUF0ZDhYVFpVblYzOGdHOEd3SEpEZXU2N3UxYkVSeDdVMFJqVlJPamc1ZXJOM01QS2Jqck4yWWpHZHYxRwpVdmdDREd6aFpIa0o5a0xINDBSWVJqZkdTazBlM0owZWQ0UHpsL3FhYk1TV3pLVjdKNlcyTE9zRjBkZFAzVlQ4CmVQSHQ3S01nME1qOWp3eGxqb1NMN1FLQmdRQ3VUdklVQ3ZDVDN3c3AvcE9tbUY5bmhQbTFLYjNEd1FuTUcwMXQKTXVFVGpZdDlsbG4ya3RicmFablZROVpvNWk5VXRBZWNiRlVKQWFWRTc1NGQyWERkUzdrQ2xDQlJGSnRGN3B0KwpteEFsdlRiNm9ZMEdwZ01ySm54VzFxd0dycGVuUGxseTdYSUhIWk54SVlkQUJyakJ5ckp3MlFVQWZiUFk1c1h6CjhzK1dBUUtCZ0N2SWtucG9ERFN5N25lV3JQNkM3NFJQbFBBc3Q2eWNJZVp2cXBSVWo4ZVVzK0w3TlV0WXJVcHAKRGUyYTRaUWpjc2xEZzFQNk5vdEdLdjhSNCtFb0tQZ3JDRWNjZ2ZNU1JSMEZGZDJaYUtoVDZtVy9Qb1NURlFPNgpTbXprYTMxZ01GekNBUzVVSkFsc3dnQitJSHl0NnFhRlJQM1BLQmlXTjRvOUVYU1NXdWFBCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
      ---
      # Source: cilium/templates/hubble/tls-helm/server-secret.yaml
      apiVersion: v1
      kind: Secret
      metadata:
        name: hubble-server-certs
        namespace: kube-system
        labels:
          cilium.io/helm-template-non-idempotent: "true"

        annotations:
      type: kubernetes.io/tls
      data:
        ca.crt:  LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURGRENDQWZ5Z0F3SUJBZ0lSQVA2VFF6WnlsNTM5M0FyWkNrUVBLOUl3RFFZSktvWklodmNOQVFFTEJRQXcKRkRFU01CQUdBMVVFQXhNSlEybHNhWFZ0SUVOQk1CNFhEVEkyTURJeE5ERXlNVEF5TmxvWERUSTVNREl4TXpFeQpNVEF5Tmxvd0ZERVNNQkFHQTFVRUF4TUpRMmxzYVhWdElFTkJNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DCkFROEFNSUlCQ2dLQ0FRRUFxR1lwVFFoSnZMNk5TN1hBNFdmdFlRaGVqWFAvM2JMU2M0Qm14MzhRQXRaS2VoV2QKVk5XNTh0dzU4R3RVM1dQYUkxM01VZXR2NWhMa2ttbVovMkZ1OCtydGVTMTIvV1pZTk55WU42aEZHSGpWOFB5cwo4K3QrcnZSLzkzWS8rcUJqWGg0bEpVaHdzdFduNXNxaUpiRytVbzkxMWozUzZxU01oWXBTckpKdWxndk5USGtlCkxzS0xEV01COEZQMWdLTnN1cnB2K1VvQzZWTFluVFlxa0pMbHlEZjQzSTM3T3lzU1krdjRKLzduNmlGS1pTc0sKR2JOS2pCVll0ZDBGMkZwMXVUTEozQWpBSzBpc0VLb2kzelg1TGlJZ3hQSzJmQldDN25BVGZQMFpQNDZkMEtpagpFeTdwMEwvcURYWnR4KzViaVRPaGQyUDdwSHdFaFVWTHM2cURDd0lEQVFBQm8yRXdYekFPQmdOVkhROEJBZjhFCkJBTUNBcVF3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdFR0NDc0dBUVVGQndNQ01BOEdBMVVkRXdFQi93UUYKTUFNQkFmOHdIUVlEVlIwT0JCWUVGSTd2cmtrcXNJWkI4K0tpZ09WLzdTOUlkNkZiTUEwR0NTcUdTSWIzRFFFQgpDd1VBQTRJQkFRQ1hVSCtCL3J1NEtBNVlnWVl4ZHM1dUlaek1qYjlUOFhpTlA1bFRtcXplSnI3S3hTZStwbTU5CjNTNnlsQTQvMVdVcGlrdFBUMUlOUHJ1WFZXVUJGL1NyRE4wWDIyT0psWlg2YjdVWUduaUVnZDJ6MDVLOStBTzUKYTZ0YSt3bnI0SHg0Z0dmWnhHcytjazhwMTBjeC9HeWpDY1c1THZWMDQvOWo4QVdFamNtcDBFV1oxRUszWnlSdAp3eGNsbHJVcC8ySHVxa1lSdS85Q0ljV3ZRVEV0RDIwN1lRN25QVjFzWnVCUVhtVnlzVEVPN2thbmRCYWlxdGVaClBaYURGckJzdnFHME5yblJJL3oyRUNJZnFxVUNrNUpBNDhlcEs4SGJzOWZ6TnU5bVNYSTVmcDh3UnVGR0xidFgKR0ZoZURHbEVUR0o2RUp4aHBVQS81dUpnZzJXZlE4YlUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
        tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURWekNDQWorZ0F3SUJBZ0lSQUk0WWsyWUNmTGZILzRvTXZCamtYU2t3RFFZSktvWklodmNOQVFFTEJRQXcKRkRFU01CQUdBMVVFQXhNSlEybHNhWFZ0SUVOQk1CNFhEVEkyTURJeE5ERTJOVEUxT1ZvWERUSTNNREl4TkRFMgpOVEUxT1Zvd0tqRW9NQ1lHQTFVRUF3d2ZLaTVrWldaaGRXeDBMbWgxWW1Kc1pTMW5jbkJqTG1OcGJHbDFiUzVwCmJ6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU5Sc20xU0M4ODBIQ3V0Vy85M2oKL3o2ZjFpM0pKZU16OG5XK2dvREVaaXZEdk4xWi9UM1VveTAwY1dxdWpYTzN5SWtPY0U1bXBPTExCUU5YVnVFagpqclJ2N2lMTkI5Uk9kcHFyYi9tZlRkeEJ3TVJTQUVSdUxuZG1yUFpTOWVkT2lwajVWb1YzWEdZblkyZ3RLZ2VKClNJelBGckliZ0NMYnRFS1k2SUFkVmRXRVhFeEZTSnZrclhCS1phKzR4dW1IRU9DbEdWVGhpNjdpUEErQVkvT2YKUEZYMGpRV3RQcUF4bjAvcStUeng0eDJYL1RIcnFxTER0V1pGYmxIMUtKVzJkMXI2RkFsRk4wUDF4Rjk4b3lLeAo1TmlScmUzekd2bWs3UlJKYUVqRE9laXBLblhrSW1kWDUrb2NNZkIyLzYxSEErazJIL1o4Wk9sUkVLUEdORU1oCmxoY0NBd0VBQWFPQmpUQ0JpakFPQmdOVkhROEJBZjhFQkFNQ0JhQXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUgKQXdFR0NDc0dBUVVGQndNQ01Bd0dBMVVkRXdFQi93UUNNQUF3SHdZRFZSMGpCQmd3Rm9BVWp1K3VTU3F3aGtIego0cUtBNVgvdEwwaDNvVnN3S2dZRFZSMFJCQ013SVlJZktpNWtaV1poZFd4MExtaDFZbUpzWlMxbmNuQmpMbU5wCmJHbDFiUzVwYnpBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQVoxWFR3QnBEY1dhcHRGdWFtSGtGYkphNDdIYVUKRHA2QkhDQ0ttWDNuQ090cWJZbGVZV3Jta1QwY29naDV1L3dPTnpPVFk1Mi9UTEdMYjFDendGUFUyUUVHNkJ5awpuZGlwb0s4dG9PeXlYRlpFdVZCUDJKL28rRTcyUEM1S2RYSzJFM2hLMlNtb0YvbzZReHU2WXp3MWYyeGxMa2RmCldmeE5FdjMwM1NLRkRUNTh4bWlrMnlsOEFZakJZcG43SWRldkhtUjRNN2ZuTEhXcjVsR1M2V3pkSWJYekdRT3IKMnBzMmxsNCtEK29PU21vekRrQ2I4eG42ckNYNXd4WmFjUEpLWFpreFZzbHg2MkUvUWFXTlBhYmpPTHFTWTNoVgpEUDA1aXg1dUkrWjc1MkNPWi9rQUl0YkVYZWFnWDgyeHFjSjB4aHdaYXRFSmE2N0J5K3FUQmhiTGtRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
        tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBMUd5YlZJTHp6UWNLNjFiLzNlUC9QcC9XTGNrbDR6UHlkYjZDZ01SbUs4TzgzVm45ClBkU2pMVFJ4YXE2TmM3ZklpUTV3VG1hazRzc0ZBMWRXNFNPT3RHL3VJczBIMUU1Mm1xdHYrWjlOM0VIQXhGSUEKUkc0dWQyYXM5bEwxNTA2S21QbFdoWGRjWmlkamFDMHFCNGxJak04V3NodUFJdHUwUXBqb2dCMVYxWVJjVEVWSQptK1N0Y0VwbHI3akc2WWNRNEtVWlZPR0xydUk4RDRCajg1ODhWZlNOQmEwK29ER2ZUK3I1UFBIakhaZjlNZXVxCm9zTzFaa1Z1VWZVb2xiWjNXdm9VQ1VVM1EvWEVYM3lqSXJIazJKR3Q3Zk1hK2FUdEZFbG9TTU01NktrcWRlUWkKWjFmbjZod3g4SGIvclVjRDZUWWY5bnhrNlZFUW84WTBReUdXRndJREFRQUJBb0lCQUZzcFJMdk8rd3ZJOHZHdQpRMTRaUTJlL3RtMnR2aG0wS0dCSllyNGFDdkxMTEprZHptVWpoT2VZY3ZmaWN3ZnZIaHRiVyt6NWRkZHlZdk5kCkh3YTllTGVNdFhpdjNxVkpDdk16a1hsaDJVc2wyTEVuczcrcVBUeTJqcEdqWnE1ZWNYSld4cisrU3FQNFVWdmEKemdldjdiZW9BOGhwcnVMR3dLUTM5TWRPVDVDeVZhM1N4M044d21iSk1XemowYkMvMUlxS3pxNXZRZFNGUUR6MQpWMVcvdVdRdlBNamN3anNyTWF6ZW5Dd3UwZnpUb2NCZ1BzaWNBcWg0WWZVL3owRUJOL0czWHRKTy9WUTNZSGlYCjhOUkpzVDcrQ2ZpeFRHczBRU2NVdDIyZm8rTk9WQ3U0VEswNVJjanlYN1NIYjhkNE9rbytrcUl3eFlTenJCd1cKSDhVNmRaRUNnWUVBN1gyalA1S2F0N3pKRGhpZ09OUHZzV1ZQcXV6cUhFa0xDSEFtTEljUkJtVG96RFI4SjRYcgp2cjZZdmZpUkVDcVFwLytQVDlBZ3FaajRnNnlBZ0wzRkRIWWEydXZWUFNqRHY5dWFBaUtWa1I2SWYvRTB1K2IrClF0T0tSU3hXM2hiSU1xaXMyTnppbDM2VmtqbFJ3RnQvVUtsd1NKRWtjdFVLZ3pjVGl5aSs5ZGtDZ1lFQTVQclkKN2FVd21od1RSRjJWK25XV2MzVXZ3VkRwUXJVNnZ1bHdjUU5TL1lrenVLa2d3RHRQWmttdkl6UGs1NkgrdWRjRgpIaHkvd3R5SmhqNDRhL0dJd0dhaFlMSENoT3dmRWRUOXplWk5GVEtDb1lQZmJmeWdhdXo2NWRCR0FhQmNXQ0ZICm9abWZmbWNISm9MWHhEUWlVdmg1OHJ0a2F4YkVrdzFOOGg0dHhXOENnWUJqMDlmM05Rek1CeE1NVmRXampaTEgKb3FwbVVzZmxzOTVyWVpqcVJxd2xYKzFyU1BTWE9IZnI2Zm9TZ0pXWmtnclVVMXhPVkZJbWVDS2VWcmg5WlVlYgpBVm93ZzhsU3QvdndmY0t5K3c2YnZaWHJFZHowenhnNXh1bnNRY01SLzhtUFljK21LTk1ta3hNVUwvdnBPNHk4CnZ6eHZoSE1wd2R0MVpJVldqWDRYb1FLQmdRQ05OYVZSNk8xd0hLQkZLUEcwNDQ5RTVKL3V0OWNpTEdGdUdzZ2MKNmMva1N4aDZhTktwdWVuZFN0T1hBZ25JVHo2bm5OS3JIMCtpL0I1VGkwdUFSaFB2azFzeUptMnZTMjVkc054VQpmaEpMWURydklFUkpyK0crRHljclVxWFptdXRYN2k0ZW1uNmhsU2Z6dC8wWUlvNklYSFBZSFhod0VqcG45V3g4ClErQTJRUUtCZ0Z5MENKMmVHQzZVVkx3UzFxSGZ1RU5jVXM0ek1SQzYxM3N1aFJsd09PUEd3M09NdmR4c2pzdDQKdXNkbmJyR3VXbGJVb2JQalZkSHZuMGhrR0pJNUowamRhRm9oSkNpanlLOW92b0plaXNsT1YzcHNsemwxUWJOVAo4NzlJY1FjSGNzR0xaUDVlSHg3NDlxemdQUnZyK2xoOGFMNHdzUmRtTG9WM1laVDdsVnA1Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
      ---
      # Source: cilium/templates/cilium-configmap.yaml
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: cilium-config
        namespace: kube-system
      data:

        # Identity allocation mode selects how identities are shared between cilium
        # nodes by setting how they are stored. The options are "crd", "kvstore" or
        # "doublewrite-readkvstore" / "doublewrite-readcrd".
        # - "crd" stores identities in kubernetes as CRDs (custom resource definition).
        #   These can be queried with:
        #     kubectl get ciliumid
        # - "kvstore" stores identities in an etcd kvstore, that is
        #   configured below. Cilium versions before 1.6 supported only the kvstore
        #   backend. Upgrades from these older cilium versions should continue using
        #   the kvstore by commenting out the identity-allocation-mode below, or
        #   setting it to "kvstore".
        # - "doublewrite" modes store identities in both the kvstore and CRDs. This is useful
        #   for seamless migrations from the kvstore mode to the crd mode. Consult the
        #   documentation for more information on how to perform the migration.
        identity-allocation-mode: crd

        identity-heartbeat-timeout: "30m0s"
        identity-gc-interval: "15m0s"
        cilium-endpoint-gc-interval: "5m0s"
        nodes-gc-interval: "5m0s"

        # If you want to run cilium in debug mode change this value to true
        debug: "false"
        debug-verbose: ""
        metrics-sampling-interval: "5m"
        # The agent can be put into the following three policy enforcement modes
        # default, always and never.
        # https://docs.cilium.io/en/latest/security/policy/intro/#policy-enforcement-modes
        enable-policy: "default"
        policy-cidr-match-mode: ""
        # If you want metrics enabled in cilium-operator, set the port for
        # which the Cilium Operator will have their metrics exposed.
        # NOTE that this will open the port on the nodes where Cilium operator pod
        # is scheduled.
        operator-prometheus-serve-addr: ":9963"
        enable-metrics: "true"
        enable-policy-secrets-sync: "true"
        policy-secrets-only-from-secrets-namespace: "true"
        policy-secrets-namespace: "cilium-secrets"

        # Enable IPv4 addressing. If enabled, all endpoints are allocated an IPv4
        # address.
        enable-ipv4: "true"

        # Enable IPv6 addressing. If enabled, all endpoints are allocated an IPv6
        # address.
        enable-ipv6: "false"
        # Users who wish to specify their own custom CNI configuration file must set
        # custom-cni-conf to "true", otherwise Cilium may overwrite the configuration.
        custom-cni-conf: "false"
        enable-bpf-clock-probe: "false"
        # If you want cilium monitor to aggregate tracing for packets, set this level
        # to "low", "medium", or "maximum". The higher the level, the less packets
        # that will be seen in monitor output.
        monitor-aggregation: medium

        # The monitor aggregation interval governs the typical time between monitor
        # notification events for each allowed connection.
        #
        # Only effective when monitor aggregation is set to "medium" or higher.
        monitor-aggregation-interval: "5s"

        # The monitor aggregation flags determine which TCP flags which, upon the
        # first observation, cause monitor notifications to be generated.
        #
        # Only effective when monitor aggregation is set to "medium" or higher.
        monitor-aggregation-flags: all
        # Specifies the ratio (0.0-1.0] of total system memory to use for dynamic
        # sizing of the TCP CT, non-TCP CT, NAT and policy BPF maps.
        bpf-map-dynamic-size-ratio: "0.0025"
        # bpf-policy-map-max specifies the maximum number of entries in endpoint
        # policy map (per endpoint)
        bpf-policy-map-max: "16384"
        # bpf-policy-stats-map-max specifies the maximum number of entries in global
        # policy stats map
        bpf-policy-stats-map-max: "65536"
        # bpf-lb-map-max specifies the maximum number of entries in bpf lb service,
        # backend and affinity maps.
        bpf-lb-map-max: "65536"
        bpf-lb-external-clusterip: "false"
        bpf-lb-source-range-all-types: "false"
        bpf-lb-algorithm-annotation: "false"
        bpf-lb-mode-annotation: "false"

        bpf-distributed-lru: "false"
        bpf-events-drop-enabled: "true"
        bpf-events-policy-verdict-enabled: "true"
        bpf-events-trace-enabled: "true"

        # Pre-allocation of map entries allows per-packet latency to be reduced, at
        # the expense of up-front memory allocation for the entries in the maps. The
        # default value below will minimize memory usage in the default installation;
        # users who are sensitive to latency may consider setting this to "true".
        #
        # This option was introduced in Cilium 1.4. Cilium 1.3 and earlier ignore
        # this option and behave as though it is set to "true".
        #
        # If this value is modified, then during the next Cilium startup the restore
        # of existing endpoints and tracking of ongoing connections may be disrupted.
        # As a result, reply packets may be dropped and the load-balancing decisions
        # for established connections may change.
        #
        # If this option is set to "false" during an upgrade from 1.3 or earlier to
        # 1.4 or later, then it may cause one-time disruptions during the upgrade.
        preallocate-bpf-maps: "false"

        # Name of the cluster. Only relevant when building a mesh of clusters.
        cluster-name: "default"
        # Unique ID of the cluster. Must be unique across all connected clusters and
        # in the range of 1 and 255. Only relevant when building a mesh of clusters.
        cluster-id: "0"

        # Encapsulation mode for communication between nodes
        # Possible values:
        #   - disabled
        #   - vxlan (default)
        #   - geneve

        routing-mode: "tunnel"
        tunnel-protocol: "vxlan"
        tunnel-source-port-range: "0-0"
        service-no-backend-response: "reject"
        policy-deny-response: "none"


        # Enables L7 proxy for L7 policy enforcement and visibility
        enable-l7-proxy: "true"
        enable-ipv4-masquerade: "true"
        enable-ipv4-big-tcp: "false"
        enable-ipv6-big-tcp: "false"
        enable-ipv6-masquerade: "true"
        enable-tunnel-big-tcp: "false"
        enable-tcx: "true"
        datapath-mode: "veth"
        enable-masquerade-to-route-source: "false"

        enable-xt-socket-fallback: "true"
        install-no-conntrack-iptables-rules: "false"
        iptables-random-fully: "false"

        auto-direct-node-routes: "false"
        direct-routing-skip-unreachable: "false"



        kube-proxy-replacement: "true"
        kube-proxy-replacement-healthz-bind-address: ""
        enable-no-service-endpoints-routable: "true"
        bpf-lb-sock: "false"
        nodeport-addresses: ""
        enable-health-check-nodeport: "true"
        enable-health-check-loadbalancer-ip: "false"
        node-port-bind-protection: "true"
        enable-auto-protect-node-port-range: "true"
        bpf-lb-acceleration: "disabled"
        enable-l2-neigh-discovery: "false"
        k8s-require-ipv4-pod-cidr: "false"
        k8s-require-ipv6-pod-cidr: "false"
        enable-k8s-networkpolicy: "true"
        enable-endpoint-lockdown-on-policy-overflow: "false"
        # Tell the agent to generate and write a CNI configuration file
        write-cni-conf-when-ready: /host/etc/cni/net.d/05-cilium.conflist
        cni-exclusive: "true"
        cni-log-file: "/var/run/cilium/cilium-cni.log"
        enable-endpoint-health-checking: "true"
        enable-health-checking: "true"
        health-check-icmp-failure-threshold: "3"
        enable-well-known-identities: "false"
        enable-node-selector-labels: "false"
        synchronize-k8s-nodes: "true"
        operator-api-serve-addr: "127.0.0.1:9234"

        enable-hubble: "true"
        # UNIX domain socket for Hubble server to listen to.
        hubble-socket-path: "/var/run/cilium/hubble.sock"
        hubble-network-policy-correlation-enabled: "true"
        # An additional address for Hubble server to listen to (e.g. ":4244").
        hubble-listen-address: ":4244"
        hubble-disable-tls: "false"
        hubble-tls-cert-file: /var/lib/cilium/tls/hubble/server.crt
        hubble-tls-key-file: /var/lib/cilium/tls/hubble/server.key
        hubble-tls-client-ca-files: /var/lib/cilium/tls/hubble/client-ca.crt
        ipam: "kubernetes"
        ipam-cilium-node-update-rate: "15s"

        default-lb-service-ipam: "lbipam"
        egress-gateway-reconciliation-trigger-interval: "1s"
        enable-vtep: "false"
        vtep-endpoint: ""
        vtep-cidr: ""
        vtep-mask: ""
        vtep-mac: ""
        enable-bgp-control-plane: "true"
        bgp-secrets-namespace: "kube-system"
        enable-bgp-control-plane-status-report: "true"
        bgp-router-id-allocation-mode: "default"
        bgp-router-id-allocation-ip-pool: ""
        enable-bgp-legacy-origin-attribute: "false"

        packetization-layer-pmtud-mode: "blackhole"
        procfs: "/host/proc"
        bpf-root: "/sys/fs/bpf"
        cgroup-root: "/sys/fs/cgroup"

        identity-management-mode: "agent"
        enable-sctp: "false"
        remove-cilium-node-taints: "true"
        set-cilium-node-taints: "true"
        set-cilium-is-up-condition: "true"
        unmanaged-pod-watcher-interval: "15s"
        # default DNS proxy to transparent mode in non-chaining modes
        dnsproxy-enable-transparent-mode: "true"
        dnsproxy-socket-linger-timeout: "10"
        tofqdns-dns-reject-response-code: "refused"
        tofqdns-enable-dns-compression: "true"
        tofqdns-endpoint-max-ip-per-hostname: "1000"
        tofqdns-idle-connection-grace-period: "0s"
        tofqdns-max-deferred-connection-deletes: "10000"
        tofqdns-proxy-response-max-delay: "100ms"
        tofqdns-preallocate-identities:  "true"
        agent-not-ready-taint-key: "node.cilium.io/agent-not-ready"

        mesh-auth-enabled: "false"
        mesh-auth-queue-size: "1024"
        mesh-auth-rotated-identities-queue-size: "1024"
        mesh-auth-gc-interval: "5m0s"

        proxy-xff-num-trusted-hops-ingress: "0"
        proxy-xff-num-trusted-hops-egress: "0"
        proxy-connect-timeout: "2"
        proxy-initial-fetch-timeout: "30"
        proxy-max-active-downstream-connections: "50000"
        proxy-max-requests-per-connection: "0"
        proxy-max-connection-duration-seconds: "0"
        proxy-idle-timeout-seconds: "60"
        proxy-max-concurrent-retries: "128"
        proxy-use-original-source-address: "true"
        proxy-cluster-max-connections: "1024"
        proxy-cluster-max-requests: "1024"
        http-retry-count: "3"
        http-stream-idle-timeout: "300"

        external-envoy-proxy: "true"
        envoy-base-id: "0"
        envoy-access-log-buffer-size: "4096"
        envoy-keep-cap-netbindservice: "false"
        max-connected-clusters: "255"
        clustermesh-cache-ttl: "0s"
        clustermesh-enable-endpoint-sync: "false"
        clustermesh-enable-mcs-api: "false"
        clustermesh-mcs-api-install-crds: "true"
        policy-default-local-cluster: "true"

        nat-map-stats-entries: "32"
        nat-map-stats-interval: "30s"
        enable-lb-ipam: "true"
        enable-non-default-deny-policies: "true"
        enable-source-ip-verification: "true"

      # Extra config allows adding arbitrary properties to the cilium config.
      # By putting it at the end of the ConfigMap, it's also possible to override existing properties.
      ---
      # Source: cilium/templates/cilium-envoy/configmap.yaml
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: cilium-envoy-config
        namespace: kube-system
      data:
        # Keep the key name as bootstrap-config.json to avoid breaking changes
        bootstrap-config.json: |
          {"admin":{"address":{"pipe":{"path":"/var/run/cilium/envoy/sockets/admin.sock"}}},"applicationLogConfig":{"logFormat":{"textFormat":"[%Y-%m-%d %T.%e][%t][%l][%n] [%g:%#] %v"}},"bootstrapExtensions":[{"name":"envoy.bootstrap.internal_listener","typedConfig":{"@type":"type.googleapis.com/envoy.extensions.bootstrap.internal_listener.v3.InternalListener"}}],"dynamicResources":{"cdsConfig":{"apiConfigSource":{"apiType":"GRPC","grpcServices":[{"envoyGrpc":{"clusterName":"xds-grpc-cilium"}}],"setNodeOnFirstMessageOnly":true,"transportApiVersion":"V3"},"initialFetchTimeout":"30s","resourceApiVersion":"V3"},"ldsConfig":{"apiConfigSource":{"apiType":"GRPC","grpcServices":[{"envoyGrpc":{"clusterName":"xds-grpc-cilium"}}],"setNodeOnFirstMessageOnly":true,"transportApiVersion":"V3"},"initialFetchTimeout":"30s","resourceApiVersion":"V3"}},"node":{"cluster":"ingress-cluster","id":"host~127.0.0.1~no-id~localdomain"},"overloadManager":{"resourceMonitors":[{"name":"envoy.resource_monitors.global_downstream_max_connections","typedConfig":{"@type":"type.googleapis.com/envoy.extensions.resource_monitors.downstream_connections.v3.DownstreamConnectionsConfig","max_active_downstream_connections":"50000"}}]},"staticResources":{"clusters":[{"circuitBreakers":{"thresholds":[{"maxRetries":128}]},"cleanupInterval":"2.500s","connectTimeout":"2s","lbPolicy":"CLUSTER_PROVIDED","name":"ingress-cluster","type":"ORIGINAL_DST","typedExtensionProtocolOptions":{"envoy.extensions.upstreams.http.v3.HttpProtocolOptions":{"@type":"type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions","commonHttpProtocolOptions":{"idleTimeout":"60s","maxConnectionDuration":"0s","maxRequestsPerConnection":0},"useDownstreamProtocolConfig":{}}}},{"circuitBreakers":{"thresholds":[{"maxRetries":128}]},"cleanupInterval":"2.500s","connectTimeout":"2s","lbPolicy":"CLUSTER_PROVIDED","name":"egress-cluster-tls","transportSocket":{"name":"cilium.tls_wrapper","typedConfig":{"@type":"type.googleapis.com/cilium.UpstreamTlsWrapperContext"}},"type":"ORIGINAL_DST","typedExtensionProtocolOptions":{"envoy.extensions.upstreams.http.v3.HttpProtocolOptions":{"@type":"type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions","commonHttpProtocolOptions":{"idleTimeout":"60s","maxConnectionDuration":"0s","maxRequestsPerConnection":0},"upstreamHttpProtocolOptions":{},"useDownstreamProtocolConfig":{}}}},{"circuitBreakers":{"thresholds":[{"maxRetries":128}]},"cleanupInterval":"2.500s","connectTimeout":"2s","lbPolicy":"CLUSTER_PROVIDED","name":"egress-cluster","type":"ORIGINAL_DST","typedExtensionProtocolOptions":{"envoy.extensions.upstreams.http.v3.HttpProtocolOptions":{"@type":"type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions","commonHttpProtocolOptions":{"idleTimeout":"60s","maxConnectionDuration":"0s","maxRequestsPerConnection":0},"useDownstreamProtocolConfig":{}}}},{"circuitBreakers":{"thresholds":[{"maxRetries":128}]},"cleanupInterval":"2.500s","connectTimeout":"2s","lbPolicy":"CLUSTER_PROVIDED","name":"ingress-cluster-tls","transportSocket":{"name":"cilium.tls_wrapper","typedConfig":{"@type":"type.googleapis.com/cilium.UpstreamTlsWrapperContext"}},"type":"ORIGINAL_DST","typedExtensionProtocolOptions":{"envoy.extensions.upstreams.http.v3.HttpProtocolOptions":{"@type":"type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions","commonHttpProtocolOptions":{"idleTimeout":"60s","maxConnectionDuration":"0s","maxRequestsPerConnection":0},"upstreamHttpProtocolOptions":{},"useDownstreamProtocolConfig":{}}}},{"connectTimeout":"2s","loadAssignment":{"clusterName":"xds-grpc-cilium","endpoints":[{"lbEndpoints":[{"endpoint":{"address":{"pipe":{"path":"/var/run/cilium/envoy/sockets/xds.sock"}}}}]}]},"name":"xds-grpc-cilium","type":"STATIC","typedExtensionProtocolOptions":{"envoy.extensions.upstreams.http.v3.HttpProtocolOptions":{"@type":"type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions","explicitHttpConfig":{"http2ProtocolOptions":{}}}}},{"connectTimeout":"2s","loadAssignment":{"clusterName":"/envoy-admin","endpoints":[{"lbEndpoints":[{"endpoint":{"address":{"pipe":{"path":"/var/run/cilium/envoy/sockets/admin.sock"}}}}]}]},"name":"/envoy-admin","type":"STATIC"}],"listeners":[{"address":{"socketAddress":{"address":"0.0.0.0","portValue":9964}},"filterChains":[{"filters":[{"name":"envoy.filters.network.http_connection_manager","typedConfig":{"@type":"type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager","httpFilters":[{"name":"envoy.filters.http.router","typedConfig":{"@type":"type.googleapis.com/envoy.extensions.filters.http.router.v3.Router"}}],"internalAddressConfig":{"cidrRanges":[{"addressPrefix":"10.0.0.0","prefixLen":8},{"addressPrefix":"172.16.0.0","prefixLen":12},{"addressPrefix":"192.168.0.0","prefixLen":16},{"addressPrefix":"127.0.0.1","prefixLen":32}]},"routeConfig":{"virtualHosts":[{"domains":["*"],"name":"prometheus_metrics_route","routes":[{"match":{"prefix":"/metrics"},"name":"prometheus_metrics_route","route":{"cluster":"/envoy-admin","prefixRewrite":"/stats/prometheus"}}]}]},"statPrefix":"envoy-prometheus-metrics-listener","streamIdleTimeout":"300s"}}]}],"name":"envoy-prometheus-metrics-listener"},{"address":{"socketAddress":{"address":"127.0.0.1","portValue":9878}},"filterChains":[{"filters":[{"name":"envoy.filters.network.http_connection_manager","typedConfig":{"@type":"type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager","httpFilters":[{"name":"envoy.filters.http.router","typedConfig":{"@type":"type.googleapis.com/envoy.extensions.filters.http.router.v3.Router"}}],"internalAddressConfig":{"cidrRanges":[{"addressPrefix":"10.0.0.0","prefixLen":8},{"addressPrefix":"172.16.0.0","prefixLen":12},{"addressPrefix":"192.168.0.0","prefixLen":16},{"addressPrefix":"127.0.0.1","prefixLen":32}]},"routeConfig":{"virtual_hosts":[{"domains":["*"],"name":"health","routes":[{"match":{"prefix":"/healthz"},"name":"health","route":{"cluster":"/envoy-admin","prefixRewrite":"/ready"}}]}]},"statPrefix":"envoy-health-listener","streamIdleTimeout":"300s"}}]}],"name":"envoy-health-listener"}]}}
      ---
      # Source: cilium/templates/cilium-agent/clusterrole.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRole
      metadata:
        name: cilium
        labels:
          app.kubernetes.io/part-of: cilium
      rules:
      - apiGroups:
        - networking.k8s.io
        resources:
        - networkpolicies
        verbs:
        - get
        - list
        - watch
      - apiGroups:
        - discovery.k8s.io
        resources:
        - endpointslices
        verbs:
        - get
        - list
        - watch
      - apiGroups:
        - ""
        resources:
        - namespaces
        - services
        - pods
        - endpoints
        - nodes
        verbs:
        - get
        - list
        - watch
      - apiGroups:
        - apiextensions.k8s.io
        resources:
        - customresourcedefinitions
        verbs:
        - list
        - watch
        # This is used when validating policies in preflight. This will need to stay
        # until we figure out how to avoid "get" inside the preflight, and then
        # should be removed ideally.
        - get
      - apiGroups:
        - cilium.io
        resources:
        - ciliumloadbalancerippools
        - ciliumbgpnodeconfigs
        - ciliumbgpadvertisements
        - ciliumbgppeerconfigs
        - ciliumclusterwideenvoyconfigs
        - ciliumclusterwidenetworkpolicies
        - ciliumegressgatewaypolicies
        - ciliumendpoints
        - ciliumendpointslices
        - ciliumenvoyconfigs
        - ciliumidentities
        - ciliumlocalredirectpolicies
        - ciliumnetworkpolicies
        - ciliumnodes
        - ciliumnodeconfigs
        - ciliumcidrgroups
        - ciliuml2announcementpolicies
        - ciliumpodippools
        verbs:
        - list
        - watch
      - apiGroups:
        - cilium.io
        resources:
        - ciliumidentities
        - ciliumendpoints
        - ciliumnodes
        verbs:
        - create
      - apiGroups:
        - cilium.io
        # To synchronize garbage collection of such resources
        resources:
        - ciliumidentities
        verbs:
        - update
      - apiGroups:
        - cilium.io
        resources:
        - ciliumendpoints
        verbs:
        - delete
        - get
      - apiGroups:
        - cilium.io
        resources:
        - ciliumnodes
        - ciliumnodes/status
        verbs:
        - get
        - update
      - apiGroups:
        - cilium.io
        resources:
        - ciliumendpoints/status
        - ciliumendpoints
        - ciliuml2announcementpolicies/status
        - ciliumbgpnodeconfigs/status
        verbs:
        - patch
      ---
      # Source: cilium/templates/cilium-operator/clusterrole.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRole
      metadata:
        name: cilium-operator
        labels:
          app.kubernetes.io/part-of: cilium
      rules:
      - apiGroups:
        - ""
        resources:
        - pods
        verbs:
        - get
        - list
        - watch
        # to automatically delete [core|kube]dns pods so that are starting to being
        # managed by Cilium
        - delete
      - apiGroups:
        - ""
        resources:
        - configmaps
        resourceNames:
        - cilium-config
        verbs:
         # allow patching of the configmap to set annotations
        - patch
      - apiGroups:
        - ""
        resources:
        - nodes
        verbs:
        - list
        - watch
      - apiGroups:
        - ""
        resources:
        # To remove node taints
        - nodes
        # To set NetworkUnavailable false on startup
        - nodes/status
        verbs:
        - patch
      - apiGroups:
        - discovery.k8s.io
        resources:
        - endpointslices
        verbs:
        - get
        - list
        - watch
      - apiGroups:
        - ""
        resources:
        # to perform LB IP allocation for BGP
        - services/status
        verbs:
        - update
        - patch
      - apiGroups:
        - ""
        resources:
        # to check apiserver connectivity
        - namespaces
        - secrets
        verbs:
        - get
        - list
        - watch
      - apiGroups:
        - ""
        resources:
        # to perform the translation of a CNP that contains `ToGroup` to its endpoints
        - services
        - endpoints
        verbs:
        - get
        - list
        - watch
      - apiGroups:
        - cilium.io
        resources:
        - ciliumnetworkpolicies
        - ciliumclusterwidenetworkpolicies
        verbs:
        # Create auto-generated CNPs and CCNPs from Policies that have 'toGroups'
        - create
        - update
        - deletecollection
        # To update the status of the CNPs and CCNPs
        - patch
        - get
        - list
        - watch
      - apiGroups:
        - cilium.io
        resources:
        - ciliumnetworkpolicies/status
        - ciliumclusterwidenetworkpolicies/status
        verbs:
        # Update the auto-generated CNPs and CCNPs status.
        - patch
        - update
      - apiGroups:
        - cilium.io
        resources:
        - ciliumendpoints
        - ciliumidentities
        verbs:
        # To perform garbage collection of such resources
        - delete
        - list
        - watch
      - apiGroups:
        - cilium.io
        resources:
        - ciliumidentities
        verbs:
        # To synchronize garbage collection of such resources
        - update
      - apiGroups:
        - cilium.io
        resources:
        - ciliumnodes
        verbs:
        - create
        - update
        - get
        - list
        - watch
          # To perform CiliumNode garbage collector
        - delete
      - apiGroups:
        - cilium.io
        resources:
        - ciliumnodes/status
        verbs:
        - update
      - apiGroups:
        - cilium.io
        resources:
        - ciliumendpointslices
        - ciliumenvoyconfigs
        - ciliumbgppeerconfigs
        - ciliumbgpadvertisements
        - ciliumbgpnodeconfigs
        verbs:
        - create
        - update
        - get
        - list
        - watch
        - delete
        - patch
      - apiGroups:
        - cilium.io
        resources:
        - ciliumbgpclusterconfigs/status
        - ciliumbgppeerconfigs/status
        verbs:
        - update
      - apiGroups:
        - apiextensions.k8s.io
        resources:
        - customresourcedefinitions
        verbs:
        - create
        - get
        - list
        - watch
      - apiGroups:
        - apiextensions.k8s.io
        resources:
        - customresourcedefinitions
        verbs:
        - update
        resourceNames:
        - ciliumloadbalancerippools.cilium.io
        - ciliumbgpclusterconfigs.cilium.io
        - ciliumbgppeerconfigs.cilium.io
        - ciliumbgpadvertisements.cilium.io
        - ciliumbgpnodeconfigs.cilium.io
        - ciliumbgpnodeconfigoverrides.cilium.io
        - ciliumclusterwideenvoyconfigs.cilium.io
        - ciliumclusterwidenetworkpolicies.cilium.io
        - ciliumegressgatewaypolicies.cilium.io
        - ciliumendpoints.cilium.io
        - ciliumendpointslices.cilium.io
        - ciliumenvoyconfigs.cilium.io
        - ciliumidentities.cilium.io
        - ciliumlocalredirectpolicies.cilium.io
        - ciliumnetworkpolicies.cilium.io
        - ciliumnodes.cilium.io
        - ciliumnodeconfigs.cilium.io
        - ciliumcidrgroups.cilium.io
        - ciliuml2announcementpolicies.cilium.io
        - ciliumpodippools.cilium.io
        - ciliumgatewayclassconfigs.cilium.io
      - apiGroups:
        - cilium.io
        resources:
        - ciliumloadbalancerippools
        - ciliumpodippools
        - ciliumbgpclusterconfigs
        - ciliumbgpnodeconfigoverrides
        - ciliumbgppeerconfigs
        verbs:
        - get
        - list
        - watch
      - apiGroups:
          - cilium.io
        resources:
          - ciliumpodippools
        verbs:
          - create
      - apiGroups:
        - cilium.io
        resources:
        - ciliumloadbalancerippools/status
        verbs:
        - patch
      # For cilium-operator running in HA mode.
      #
      # Cilium operator running in HA mode requires the use of ResourceLock for Leader Election
      # between multiple running instances.
      # The preferred way of doing this is to use LeasesResourceLock as edits to Leases are less
      # common and fewer objects in the cluster watch "all Leases".
      - apiGroups:
        - coordination.k8s.io
        resources:
        - leases
        verbs:
        - create
        - get
        - update
      - apiGroups:
        - cilium.io
        resources:
        - ciliumendpointslices
        verbs:
        - deletecollection
      ---
      # Source: cilium/templates/cilium-agent/clusterrolebinding.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
        name: cilium
        labels:
          app.kubernetes.io/part-of: cilium
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: cilium
      subjects:
      - kind: ServiceAccount
        name: "cilium"
        namespace: kube-system
      ---
      # Source: cilium/templates/cilium-operator/clusterrolebinding.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
        name: cilium-operator
        labels:
          app.kubernetes.io/part-of: cilium
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: cilium-operator
      subjects:
      - kind: ServiceAccount
        name: "cilium-operator"
        namespace: kube-system
      ---
      # Source: cilium/templates/cilium-agent/role.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: Role
      metadata:
        name: cilium-config-agent
        namespace: kube-system
        labels:
          app.kubernetes.io/part-of: cilium
      rules:
      - apiGroups:
        - ""
        resources:
        - configmaps
        verbs:
        - get
        - list
        - watch
      ---
      # Source: cilium/templates/cilium-agent/role.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: Role
      metadata:
        name: cilium-bgp-control-plane-secrets
        namespace: "kube-system"
        labels:
          app.kubernetes.io/part-of: cilium
      rules:
      - apiGroups:
        - ""
        resources:
        - secrets
        verbs:
        - get
        - list
        - watch
      ---
      # Source: cilium/templates/cilium-agent/role.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: Role
      metadata:
        name: cilium-tlsinterception-secrets
        namespace: "cilium-secrets"
        labels:
          app.kubernetes.io/part-of: cilium
      rules:
      - apiGroups:
        - ""
        resources:
        - secrets
        verbs:
        - get
        - list
        - watch
      ---
      # Source: cilium/templates/cilium-operator/role.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: Role
      metadata:
        name: cilium-operator-tlsinterception-secrets
        namespace: "cilium-secrets"
        labels:
          app.kubernetes.io/part-of: cilium
      rules:
      - apiGroups:
        - ""
        resources:
        - secrets
        verbs:
        - create
        - delete
        - update
        - patch
      ---
      # Source: cilium/templates/cilium-operator/role.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: Role
      metadata:
        name: cilium-operator-ztunnel
        namespace: kube-system
        labels:
          app.kubernetes.io/part-of: cilium
      rules:
      # ZTunnel DaemonSet management permissions
      # Note: These permissions must always be granted (not conditional on encryption.type)
      # because the controller needs to clean up stale DaemonSets when ztunnel is disabled.
      - apiGroups:
        - apps
        resources:
        - daemonsets
        verbs:
        - create
        - delete
        - get
        - list
        - watch
      ---
      # Source: cilium/templates/cilium-agent/rolebinding.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: RoleBinding
      metadata:
        name: cilium-config-agent
        namespace: kube-system
        labels:
          app.kubernetes.io/part-of: cilium
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: Role
        name: cilium-config-agent
      subjects:
        - kind: ServiceAccount
          name: "cilium"
          namespace: kube-system
      ---
      # Source: cilium/templates/cilium-agent/rolebinding.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: RoleBinding
      metadata:
        name: cilium-bgp-control-plane-secrets
        namespace: "kube-system"
        labels:
          app.kubernetes.io/part-of: cilium
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: Role
        name: cilium-bgp-control-plane-secrets
      subjects:
      - kind: ServiceAccount
        name: "cilium"
        namespace: kube-system
      ---
      # Source: cilium/templates/cilium-agent/rolebinding.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: RoleBinding
      metadata:
        name: cilium-tlsinterception-secrets
        namespace: "cilium-secrets"
        labels:
          app.kubernetes.io/part-of: cilium
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: Role
        name: cilium-tlsinterception-secrets
      subjects:
      - kind: ServiceAccount
        name: "cilium"
        namespace: kube-system
      ---
      # Source: cilium/templates/cilium-operator/rolebinding.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: RoleBinding
      metadata:
        name: cilium-operator-tlsinterception-secrets
        namespace: "cilium-secrets"
        labels:
          app.kubernetes.io/part-of: cilium
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: Role
        name: cilium-operator-tlsinterception-secrets
      subjects:
      - kind: ServiceAccount
        name: "cilium-operator"
        namespace: kube-system
      ---
      # Source: cilium/templates/cilium-operator/rolebinding.yaml
      apiVersion: rbac.authorization.k8s.io/v1
      kind: RoleBinding
      metadata:
        name: cilium-operator-ztunnel
        namespace: kube-system
        labels:
          app.kubernetes.io/part-of: cilium
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: Role
        name: cilium-operator-ztunnel
      subjects:
      - kind: ServiceAccount
        name: "cilium-operator"
        namespace: kube-system
      ---
      # Source: cilium/templates/cilium-envoy/service.yaml
      apiVersion: v1
      kind: Service
      metadata:
        name: cilium-envoy
        namespace: kube-system
        annotations:
          prometheus.io/scrape: "true"
          prometheus.io/port: "9964"
        labels:
          k8s-app: cilium-envoy
          app.kubernetes.io/name: cilium-envoy
          app.kubernetes.io/part-of: cilium
          io.cilium/app: proxy
      spec:
        clusterIP: None
        type: ClusterIP
        selector:
          k8s-app: cilium-envoy
        ports:
        - name: envoy-metrics
          port: 9964
          protocol: TCP
          targetPort: 9964
      ---
      # Source: cilium/templates/hubble/peer-service.yaml
      apiVersion: v1
      kind: Service
      metadata:
        name: hubble-peer
        namespace: kube-system
        labels:
          k8s-app: cilium
          app.kubernetes.io/part-of: cilium
          app.kubernetes.io/name: hubble-peer

      spec:
        selector:
          k8s-app: cilium
        ports:
        - name: peer-service
          port: 443
          protocol: TCP
          targetPort: 4244
        internalTrafficPolicy: Local
      ---
      # Source: cilium/templates/cilium-agent/daemonset.yaml
      apiVersion: apps/v1
      kind: DaemonSet
      metadata:
        name: cilium
        namespace: kube-system
        labels:
          k8s-app: cilium
          app.kubernetes.io/part-of: cilium
          app.kubernetes.io/name: cilium-agent
      spec:
        selector:
          matchLabels:
            k8s-app: cilium
        updateStrategy:
          rollingUpdate:
            maxUnavailable: 2
          type: RollingUpdate
        template:
          metadata:
            annotations:
              kubectl.kubernetes.io/default-container: cilium-agent
            labels:
              k8s-app: cilium
              app.kubernetes.io/name: cilium-agent
              app.kubernetes.io/part-of: cilium
          spec:
            securityContext:
              appArmorProfile:
                type: Unconfined
              seccompProfile:
                type: Unconfined
            containers:
            - name: cilium-agent
              image: "quay.io/cilium/cilium:v1.19.0@sha256:be9f8571c2e114b3e12e41f785f2356ade703b2eac936aa878805565f0468c60"
              imagePullPolicy: IfNotPresent
              command:
              - cilium-agent
              args:
              - --config-dir=/tmp/cilium/config-map
              startupProbe:
                httpGet:
                  host: "127.0.0.1"
                  path: /healthz
                  port: health
                  scheme: HTTP
                  httpHeaders:
                  - name: "brief"
                    value: "true"
                failureThreshold: 300
                periodSeconds: 2
                successThreshold: 1
                initialDelaySeconds: 5
              livenessProbe:
                httpGet:
                  host: "127.0.0.1"
                  path: /healthz
                  port: health
                  scheme: HTTP
                  httpHeaders:
                  - name: "brief"
                    value: "true"
                  - name: "require-k8s-connectivity"
                    value: "false"
                periodSeconds: 30
                successThreshold: 1
                failureThreshold: 10
                timeoutSeconds: 5
              readinessProbe:
                httpGet:
                  host: "127.0.0.1"
                  path: /healthz
                  port: health
                  scheme: HTTP
                  httpHeaders:
                  - name: "brief"
                    value: "true"
                periodSeconds: 30
                successThreshold: 1
                failureThreshold: 3
                timeoutSeconds: 5
              env:
              - name: K8S_NODE_NAME
                valueFrom:
                  fieldRef:
                    apiVersion: v1
                    fieldPath: spec.nodeName
              - name: CILIUM_K8S_NAMESPACE
                valueFrom:
                  fieldRef:
                    apiVersion: v1
                    fieldPath: metadata.namespace
              - name: CILIUM_CLUSTERMESH_CONFIG
                value: /var/lib/cilium/clustermesh/
              - name: GOMEMLIMIT
                valueFrom:
                  resourceFieldRef:
                    resource: limits.memory
                    divisor: '1'
              - name: KUBERNETES_SERVICE_HOST
                value: "localhost"
              - name: KUBERNETES_SERVICE_PORT
                value: "7445"
              - name: KUBE_CLIENT_BACKOFF_BASE
                value: "1"
              - name: KUBE_CLIENT_BACKOFF_DURATION
                value: "120"
              lifecycle:
                postStart:
                  exec:
                    command:
                    - "bash"
                    - "-c"
                    - |
                          set -o errexit
                          set -o pipefail
                          set -o nounset

                          # When running in AWS ENI mode, it's likely that 'aws-node' has
                          # had a chance to install SNAT iptables rules. These can result
                          # in dropped traffic, so we should attempt to remove them.
                          # We do it using a 'postStart' hook since this may need to run
                          # for nodes which might have already been init'ed but may still
                          # have dangling rules. This is safe because there are no
                          # dependencies on anything that is part of the startup script
                          # itself, and can be safely run multiple times per node (e.g. in
                          # case of a restart).
                          if [[ "$(iptables-save | grep -E -c 'AWS-SNAT-CHAIN|AWS-CONNMARK-CHAIN')" != "0" ]];
                          then
                              echo 'Deleting iptables rules created by the AWS CNI VPC plugin'
                              iptables-save | grep -E -v 'AWS-SNAT-CHAIN|AWS-CONNMARK-CHAIN' | iptables-restore
                          fi
                          echo 'Done!'

                preStop:
                  exec:
                    command:
                    - /cni-uninstall.sh
              ports:
              - name: health
                containerPort: 9879
                hostPort: 9879
                protocol: TCP
              - name: peer-service
                containerPort: 4244
                hostPort: 4244
                protocol: TCP
              securityContext:
                seLinuxOptions:
                  level: s0
                  type: spc_t
                capabilities:
                  add:
                    - CHOWN
                    - KILL
                    - NET_ADMIN
                    - NET_RAW
                    - IPC_LOCK
                    - SYS_ADMIN
                    - SYS_RESOURCE
                    - DAC_OVERRIDE
                    - FOWNER
                    - SETGID
                    - SETUID
                  drop:
                    - ALL
              terminationMessagePolicy: FallbackToLogsOnError
              volumeMounts:
              - name: envoy-sockets
                mountPath: /var/run/cilium/envoy/sockets
                readOnly: false
              # Unprivileged containers need to mount /proc/sys/net from the host
              # to have write access
              - mountPath: /host/proc/sys/net
                name: host-proc-sys-net
              # Unprivileged containers need to mount /proc/sys/kernel from the host
              # to have write access
              - mountPath: /host/proc/sys/kernel
                name: host-proc-sys-kernel
              - name: bpf-maps
                mountPath: /sys/fs/bpf
                # Unprivileged containers can't set mount propagation to bidirectional
                # in this case we will mount the bpf fs from an init container that
                # is privileged and set the mount propagation from host to container
                # in Cilium.
                mountPropagation: HostToContainer
              # Check for duplicate mounts before mounting
              - name: cilium-cgroup
                mountPath: /sys/fs/cgroup
              - name: cilium-run
                mountPath: /var/run/cilium
              - name: cilium-netns
                mountPath: /var/run/cilium/netns
                mountPropagation: HostToContainer
              - name: etc-cni-netd
                mountPath: /host/etc/cni/net.d
              - name: clustermesh-secrets
                mountPath: /var/lib/cilium/clustermesh
                readOnly: true
                # Needed to be able to load kernel modules
              - name: lib-modules
                mountPath: /lib/modules
                readOnly: true
              - name: xtables-lock
                mountPath: /run/xtables.lock
              - name: hubble-tls
                mountPath: /var/lib/cilium/tls/hubble
                readOnly: true
              - name: tmp
                mountPath: /tmp

            initContainers:
            - name: config
              image: "quay.io/cilium/cilium:v1.19.0@sha256:be9f8571c2e114b3e12e41f785f2356ade703b2eac936aa878805565f0468c60"
              imagePullPolicy: IfNotPresent
              command:
              - cilium-dbg
              - build-config
              env:
              - name: K8S_NODE_NAME
                valueFrom:
                  fieldRef:
                    apiVersion: v1
                    fieldPath: spec.nodeName
              - name: CILIUM_K8S_NAMESPACE
                valueFrom:
                  fieldRef:
                    apiVersion: v1
                    fieldPath: metadata.namespace
              - name: KUBERNETES_SERVICE_HOST
                value: "localhost"
              - name: KUBERNETES_SERVICE_PORT
                value: "7445"
              volumeMounts:
              - name: tmp
                mountPath: /tmp
              terminationMessagePolicy: FallbackToLogsOnError
              securityContext:
                capabilities:
                  add:
                    - NET_ADMIN
                  drop:
                    - ALL
            - name: apply-sysctl-overwrites
              image: "quay.io/cilium/cilium:v1.19.0@sha256:be9f8571c2e114b3e12e41f785f2356ade703b2eac936aa878805565f0468c60"
              imagePullPolicy: IfNotPresent
              env:
              - name: BIN_PATH
                value: /opt/cni/bin
              command:
              - sh
              - -ec
              # The statically linked Go program binary is invoked to avoid any
              # dependency on utilities like sh that can be missing on certain
              # distros installed on the underlying host. Copy the binary to the
              # same directory where we install cilium cni plugin so that exec permissions
              # are available.
              - |
                cp /usr/bin/cilium-sysctlfix /hostbin/cilium-sysctlfix;
                nsenter --mount=/hostproc/1/ns/mnt "${BIN_PATH}/cilium-sysctlfix";
                rm /hostbin/cilium-sysctlfix
              volumeMounts:
              - name: hostproc
                mountPath: /hostproc
              - name: cni-path
                mountPath: /hostbin
              terminationMessagePolicy: FallbackToLogsOnError
              securityContext:
                seLinuxOptions:
                  level: s0
                  type: spc_t
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_PTRACE
                  drop:
                    - ALL
            # Mount the bpf fs if it is not mounted. We will perform this task
            # from a privileged container because the mount propagation bidirectional
            # only works from privileged containers.
            - name: mount-bpf-fs
              image: "quay.io/cilium/cilium:v1.19.0@sha256:be9f8571c2e114b3e12e41f785f2356ade703b2eac936aa878805565f0468c60"
              imagePullPolicy: IfNotPresent
              args:
              - 'mount | grep "/sys/fs/bpf type bpf" || mount -t bpf bpf /sys/fs/bpf'
              command:
              - /bin/bash
              - -c
              - --
              terminationMessagePolicy: FallbackToLogsOnError
              securityContext:
                privileged: true
              volumeMounts:
              - name: bpf-maps
                mountPath: /sys/fs/bpf
                mountPropagation: Bidirectional
            - name: clean-cilium-state
              image: "quay.io/cilium/cilium:v1.19.0@sha256:be9f8571c2e114b3e12e41f785f2356ade703b2eac936aa878805565f0468c60"
              imagePullPolicy: IfNotPresent
              command:
              - /init-container.sh
              env:
              - name: CILIUM_ALL_STATE
                valueFrom:
                  configMapKeyRef:
                    name: cilium-config
                    key: clean-cilium-state
                    optional: true
              - name: CILIUM_BPF_STATE
                valueFrom:
                  configMapKeyRef:
                    name: cilium-config
                    key: clean-cilium-bpf-state
                    optional: true
              - name: WRITE_CNI_CONF_WHEN_READY
                valueFrom:
                  configMapKeyRef:
                    name: cilium-config
                    key: write-cni-conf-when-ready
                    optional: true
              - name: KUBERNETES_SERVICE_HOST
                value: "localhost"
              - name: KUBERNETES_SERVICE_PORT
                value: "7445"
              terminationMessagePolicy: FallbackToLogsOnError
              securityContext:
                seLinuxOptions:
                  level: s0
                  type: spc_t
                capabilities:
                  add:
                    - NET_ADMIN
                    - SYS_ADMIN
                    - SYS_RESOURCE
                  drop:
                    - ALL
              volumeMounts:
              - name: bpf-maps
                mountPath: /sys/fs/bpf
                # Required to mount cgroup filesystem from the host to cilium agent pod
              - name: cilium-cgroup
                mountPath: /sys/fs/cgroup
                mountPropagation: HostToContainer
              - name: cilium-run
                mountPath: /var/run/cilium # wait-for-kube-proxy
            # Install the CNI binaries in an InitContainer so we don't have a writable host mount in the agent
            - name: install-cni-binaries
              image: "quay.io/cilium/cilium:v1.19.0@sha256:be9f8571c2e114b3e12e41f785f2356ade703b2eac936aa878805565f0468c60"
              imagePullPolicy: IfNotPresent
              command:
                - "/install-plugin.sh"
              resources:
                limits:
                  cpu: 1
                  memory: 1Gi
                requests:
                  cpu: 100m
                  memory: 10Mi
              securityContext:
                seLinuxOptions:
                  level: s0
                  type: spc_t
                capabilities:
                  drop:
                    - ALL
              terminationMessagePolicy: FallbackToLogsOnError
              volumeMounts:
                - name: cni-path
                  mountPath: /host/opt/cni/bin # .Values.cni.install
            restartPolicy: Always
            priorityClassName: system-node-critical
            serviceAccountName: "cilium"
            automountServiceAccountToken: true
            terminationGracePeriodSeconds: 1
            hostNetwork: true

            affinity:
              podAntiAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                - labelSelector:
                    matchLabels:
                      k8s-app: cilium
                  topologyKey: kubernetes.io/hostname
            nodeSelector:
              kubernetes.io/os: linux
            tolerations:
              - operator: Exists
            volumes:
            # For sharing configuration between the "config" initContainer and the agent
            - name: tmp
              emptyDir: {}
              # To keep state between restarts / upgrades
            - name: cilium-run
              hostPath:
                path: /var/run/cilium
                type: DirectoryOrCreate
              # To exec into pod network namespaces
            - name: cilium-netns
              hostPath:
                path: /var/run/netns
                type: DirectoryOrCreate
              # To keep state between restarts / upgrades for bpf maps
            - name: bpf-maps
              hostPath:
                path: /sys/fs/bpf
                type: DirectoryOrCreate
            # To mount cgroup2 filesystem on the host or apply sysctlfix
            - name: hostproc
              hostPath:
                path: /proc
                type: Directory
            # To keep state between restarts / upgrades for cgroup2 filesystem
            - name: cilium-cgroup
              hostPath:
                path: /sys/fs/cgroup
                type: DirectoryOrCreate
            # To install cilium cni plugin in the host
            - name: cni-path
              hostPath:
                path:  /opt/cni/bin
                type: DirectoryOrCreate
              # To install cilium cni configuration in the host
            - name: etc-cni-netd
              hostPath:
                path: /etc/cni/net.d
                type: DirectoryOrCreate
              # To be able to load kernel modules
            - name: lib-modules
              hostPath:
                path: /lib/modules
              # To access iptables concurrently with other processes (e.g. kube-proxy)
            - name: xtables-lock
              hostPath:
                path: /run/xtables.lock
                type: FileOrCreate
            # Sharing socket with Cilium Envoy on the same node by using a host path
            - name: envoy-sockets
              hostPath:
                path: "/var/run/cilium/envoy/sockets"
                type: DirectoryOrCreate
              # To read the clustermesh configuration
            - name: clustermesh-secrets
              projected:
                # note: the leading zero means this number is in octal representation: do not remove it
                defaultMode: 0400
                sources:
                - secret:
                    name: cilium-clustermesh
                    optional: true
                    # note: items are not explicitly listed here, since the entries of this secret
                    # depend on the peers configured, and that would cause a restart of all agents
                    # at every addition/removal. Leaving the field empty makes each secret entry
                    # to be automatically projected into the volume as a file whose name is the key.
                - secret:
                    name: clustermesh-apiserver-remote-cert
                    optional: true
                    items:
                    - key: tls.key
                      path: common-etcd-client.key
                    - key: tls.crt
                      path: common-etcd-client.crt
                    - key: ca.crt
                      path: common-etcd-client-ca.crt
                # note: we configure the volume for the kvstoremesh-specific certificate
                # regardless of whether KVStoreMesh is enabled or not, so that it can be
                # automatically mounted in case KVStoreMesh gets subsequently enabled,
                # without requiring an agent restart.
                - secret:
                    name: clustermesh-apiserver-local-cert
                    optional: true
                    items:
                    - key: tls.key
                      path: local-etcd-client.key
                    - key: tls.crt
                      path: local-etcd-client.crt
                    - key: ca.crt
                      path: local-etcd-client-ca.crt
            - name: host-proc-sys-net
              hostPath:
                path: /proc/sys/net
                type: Directory
            - name: host-proc-sys-kernel
              hostPath:
                path: /proc/sys/kernel
                type: Directory
            - name: hubble-tls
              projected:
                # note: the leading zero means this number is in octal representation: do not remove it
                defaultMode: 0400
                sources:
                - secret:
                    name: hubble-server-certs
                    optional: true
                    items:
                    - key: tls.crt
                      path: server.crt
                    - key: tls.key
                      path: server.key
                    - key: ca.crt
                      path: client-ca.crt
      ---
      # Source: cilium/templates/cilium-envoy/daemonset.yaml
      apiVersion: apps/v1
      kind: DaemonSet
      metadata:
        name: cilium-envoy
        namespace: kube-system
        labels:
          k8s-app: cilium-envoy
          app.kubernetes.io/part-of: cilium
          app.kubernetes.io/name: cilium-envoy
          name: cilium-envoy
      spec:
        selector:
          matchLabels:
            k8s-app: cilium-envoy

        updateStrategy:
          rollingUpdate:
            maxUnavailable: 2
          type: RollingUpdate
        template:
          metadata:
            annotations:
            labels:
              k8s-app: cilium-envoy
              name: cilium-envoy
              app.kubernetes.io/name: cilium-envoy
              app.kubernetes.io/part-of: cilium
          spec:
            securityContext:
              appArmorProfile:
                type: Unconfined

            containers:
            - name: cilium-envoy
              image: "quay.io/cilium/cilium-envoy:v1.35.9-1768828720-c6e4827ebca9c47af2a3a6540c563c30947bae29@sha256:696582a3391ce05a62edb4140e6a99f774351f363f5b5d7f1581f3a244430249"
              imagePullPolicy: IfNotPresent
              command:
              - /usr/bin/cilium-envoy-starter
              args:
              - '--'
              - '-c /var/run/cilium/envoy/bootstrap-config.json'
              - '--base-id 0'
              - '--log-level info'

              startupProbe:
                httpGet:
                  host: "127.0.0.1"
                  path: /healthz
                  port: 9878
                  scheme: HTTP
                failureThreshold: 105
                periodSeconds: 2
                successThreshold: 1
                initialDelaySeconds: 5
              livenessProbe:
                httpGet:
                  host: "127.0.0.1"
                  path: /healthz
                  port: 9878
                  scheme: HTTP
                periodSeconds: 30
                successThreshold: 1
                failureThreshold: 10
                timeoutSeconds: 5
              readinessProbe:
                httpGet:
                  host: "127.0.0.1"
                  path: /healthz
                  port: 9878
                  scheme: HTTP
                periodSeconds: 30
                successThreshold: 1
                failureThreshold: 3
                timeoutSeconds: 5
              env:
              - name: K8S_NODE_NAME
                valueFrom:
                  fieldRef:
                    apiVersion: v1
                    fieldPath: spec.nodeName
              - name: CILIUM_K8S_NAMESPACE
                valueFrom:
                  fieldRef:
                    apiVersion: v1
                    fieldPath: metadata.namespace
              - name: KUBERNETES_SERVICE_HOST
                value: "localhost"
              - name: KUBERNETES_SERVICE_PORT
                value: "7445"

              ports:
              - name: envoy-metrics
                containerPort: 9964
                hostPort: 9964
                protocol: TCP
              securityContext:
                seLinuxOptions:
                  level: s0
                  type: spc_t
                capabilities:
                  add:
                    - NET_ADMIN
                    - SYS_ADMIN
                  drop:
                    - ALL
              terminationMessagePolicy: FallbackToLogsOnError
              volumeMounts:
              - name: envoy-sockets
                mountPath: /var/run/cilium/envoy/sockets
                readOnly: false
              - name: envoy-artifacts
                mountPath: /var/run/cilium/envoy/artifacts
                readOnly: true
              - name: envoy-config
                mountPath: /var/run/cilium/envoy/
                readOnly: true
              - name: bpf-maps
                mountPath: /sys/fs/bpf
                mountPropagation: HostToContainer

            restartPolicy: Always
            priorityClassName: system-node-critical
            serviceAccountName: "cilium-envoy"
            automountServiceAccountToken: true
            terminationGracePeriodSeconds: 1
            hostNetwork: true

            affinity:
              nodeAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                  nodeSelectorTerms:
                  - matchExpressions:
                    - key: cilium.io/no-schedule
                      operator: NotIn
                      values:
                      - "true"
              podAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                - labelSelector:
                    matchLabels:
                      k8s-app: cilium
                  topologyKey: kubernetes.io/hostname
              podAntiAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                - labelSelector:
                    matchLabels:
                      k8s-app: cilium-envoy
                  topologyKey: kubernetes.io/hostname
            nodeSelector:
              kubernetes.io/os: linux
            tolerations:
              - operator: Exists
            volumes:
            - name: envoy-sockets
              hostPath:
                path: "/var/run/cilium/envoy/sockets"
                type: DirectoryOrCreate
            - name: envoy-artifacts
              hostPath:
                path: "/var/run/cilium/envoy/artifacts"
                type: DirectoryOrCreate
            - name: envoy-config
              configMap:
                name: "cilium-envoy-config"
                # note: the leading zero means this number is in octal representation: do not remove it
                defaultMode: 0400
                items:
                  - key: bootstrap-config.json
                    path: bootstrap-config.json
              # To keep state between restarts / upgrades
              # To keep state between restarts / upgrades for bpf maps
            - name: bpf-maps
              hostPath:
                path: /sys/fs/bpf
                type: DirectoryOrCreate
      ---
      # Source: cilium/templates/cilium-operator/deployment.yaml
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: cilium-operator
        namespace: kube-system
        labels:
          io.cilium/app: operator
          name: cilium-operator
          app.kubernetes.io/part-of: cilium
          app.kubernetes.io/name: cilium-operator
      spec:
        # See docs on ServerCapabilities.LeasesResourceLock in file pkg/k8s/version/version.go
        # for more details.
        replicas: 2
        selector:
          matchLabels:
            io.cilium/app: operator
            name: cilium-operator
        # ensure operator update on single node k8s clusters, by using rolling update with maxUnavailable=100% in case
        # of one replica and no user configured Recreate strategy.
        # otherwise an update might get stuck due to the default maxUnavailable=50% in combination with the
        # podAntiAffinity which prevents deployments of multiple operator replicas on the same node.
        strategy:
          rollingUpdate:
            maxSurge: 25%
            maxUnavailable: 50%
          type: RollingUpdate
        template:
          metadata:
            annotations:
              prometheus.io/port: "9963"
              prometheus.io/scrape: "true"
            labels:
              io.cilium/app: operator
              name: cilium-operator
              app.kubernetes.io/part-of: cilium
              app.kubernetes.io/name: cilium-operator
          spec:
            securityContext:
              seccompProfile:
                type: RuntimeDefault
            containers:
            - name: cilium-operator
              image: "quay.io/cilium/operator-generic:v1.19.0@sha256:5b04006015e5800307dc6314676edc4c0bb7ac2fc7848be2b94b43bb030ab648"
              imagePullPolicy: IfNotPresent
              command:
              - cilium-operator-generic
              args:
              - --config-dir=/tmp/cilium/config-map
              - --debug=$(CILIUM_DEBUG)
              env:
              - name: K8S_NODE_NAME
                valueFrom:
                  fieldRef:
                    apiVersion: v1
                    fieldPath: spec.nodeName
              - name: CILIUM_K8S_NAMESPACE
                valueFrom:
                  fieldRef:
                    apiVersion: v1
                    fieldPath: metadata.namespace
              - name: CILIUM_DEBUG
                valueFrom:
                  configMapKeyRef:
                    key: debug
                    name: cilium-config
                    optional: true
              - name: KUBERNETES_SERVICE_HOST
                value: "localhost"
              - name: KUBERNETES_SERVICE_PORT
                value: "7445"
              ports:
              - name: health
                containerPort: 9234
                hostPort: 9234
              - name: prometheus
                containerPort: 9963
                hostPort: 9963
                protocol: TCP
              livenessProbe:
                httpGet:
                  host: "127.0.0.1"
                  path: /healthz
                  port: health
                  scheme: HTTP
                initialDelaySeconds: 60
                periodSeconds: 10
                timeoutSeconds: 3
              readinessProbe:
                httpGet:
                  host: "127.0.0.1"
                  path: /healthz
                  port: health
                  scheme: HTTP
                initialDelaySeconds: 0
                periodSeconds: 5
                timeoutSeconds: 3
                failureThreshold: 5
              volumeMounts:
              - name: cilium-config-path
                mountPath: /tmp/cilium/config-map
                readOnly: true

              securityContext:
                allowPrivilegeEscalation: false
                capabilities:
                  drop:
                  - ALL
              terminationMessagePolicy: FallbackToLogsOnError
            hostNetwork: true
            restartPolicy: Always
            priorityClassName: system-cluster-critical
            serviceAccountName: "cilium-operator"
            automountServiceAccountToken: true
            # In HA mode, cilium-operator pods must not be scheduled on the same
            # node as they will clash with each other.
            affinity:
              podAntiAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                - labelSelector:
                    matchLabels:
                      io.cilium/app: operator
                  topologyKey: kubernetes.io/hostname
            nodeSelector:
              kubernetes.io/os: linux
            tolerations:
              - key: node-role.kubernetes.io/control-plane
                operator: Exists
              - key: node-role.kubernetes.io/master
                operator: Exists
              - key: node.kubernetes.io/not-ready
                operator: Exists
              - key: node.cloudprovider.kubernetes.io/uninitialized
                operator: Exists
              - key: node.cilium.io/agent-not-ready
                operator: Exists

            volumes:
              # To read the configuration from the config map
            - name: cilium-config-path
              configMap:
                name: cilium-config
